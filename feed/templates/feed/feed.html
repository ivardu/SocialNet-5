{% extends 'users/base.html' %}
{% load static %}
{% load crispy_forms_tags %}
{% block body %}
<div class="container">
	<!-- Feed Form -->
	<div class="container shadow-lg rounded w-50 p-3 mt-2">
		<form class="mx-auto" method="post" enctype="multipart/form-data">
			{% csrf_token %}
			{{feed_form|crispy}}
			<div class="w-25 mx-auto">
				<input class="btn btn-primary" type="submit" name="post" value="post">
			</div>
		</form>
	</div>
	<div class="container">
		{% for page_items in pages %}
		<!-- Feed individual post containers -->
		<div class="row container shadow-lg w-50 mx-auto mt-2 p-2 rounded">
			<div class="col-md-2">
				<img class="img-thumbnail rounded-circle" src="{{page_items.user.profile.image.url}}" width="100" height="100">	
			</div>
			<div class="col-md-10">
				<!-- Post Item Name -->
				<div class="row">
					<div class="col-md-6">
						<div class="row mt-2">
							{% if user == page_items.user %}
								<a class="small" href="{% url 'profile' %}">{{page_items.user.first_name}} {{page_items.user.last_name}}</a>
							{% else %}
								<a class="small" href="{% url 'rprofile' page_items.user.id %}">{{page_items.user.first_name}} {{page_items.user.last_name}}</a>
							{% endif %}
						</div>
						<!-- Post Content Date -->
						<div class="row">
							<small>{{page_items.date}}</small>
						</div>
					</div>
					<div class="col-xs-2 ml-auto">
						{% if user == page_items.user %}
							<a href="{% url 'feed:edit' page_items.id %}"><img src="{% static 'components/edit.jpg' %}" height="15" width="15"></a>
						{% endif %}
					</div>
				</div>
				<!-- Post Content -->
				<div class="row mt-2 mb-2">
					{{page_items.post}}
				</div>
				<!-- Post Images -->
				<div class="row">
					<img src="{{page_items.image.url}}" width="400" height="400">
				</div>
				<!-- Like -->
				<div class="row">
					<form method="post">
						{% csrf_token %}
							<input type="hidden" name="likes" value=1>
							<input type="hidden" name='post_id' value={{page_items.id}}>
								<input class="btn btn-link" type="submit" name="Likes" value="Likes">
							<small>{{page_items.likes_set.count}}</small>
					</form>
					
				</div>
				<!-- Comment -->
				<div class="row">
					<form method="post">
						{% csrf_token %}
						<div class="input-group">
							{{comment_form}}
							<div class="input-group-append">
								<input type="hidden" name="post_id" value="{{page_items.id}}">
								<input class="btn btn-sm btn-success" type="submit" name="submit" 
							value="comment">
							</div>
						</div>
					</form>
					<!-- <small><a href="">Comments</a></small> -->
				</div>
				<!-- Comments List -->
				<div class="pl-0">
					{% for comment in page_items.comments_set.all %}
						{% if comment.user == request.user %}
							<h6 class="small"><a href="{% url 'profile' %}">{{comment.user.first_name}} {{comment.user.last_name}} </a>
							{{comment}}</h6>
							<hr class="p-0 m-0 b-light">
						{% else %}
							<h6 class="small"><a href="{% url 'rprofile' comment.user.id %}">
							{{comment.user.first_name}} {{comment.user.last_name}} </a>
							{{comment}}</h6>
							<hr class="p-0 m-0 b-light">
						{% endif %}
					{% endfor %}
				</div>
		
			</div>
		</div>	
		{% endfor %}
		<!-- Pagination -->
		<div class="row mx-auto w-50 mt-2 p-2">
			<div class="col-xs-2 ml-auto">
				{% if pages.has_previous %}
					<a class="btn btn-outline-info" href="?page=1">First</a>
					<a class="btn btn-outline-info" href="?page={{pages.previous_page_number}}">Prev</a>
				{% endif %}
			</div>
			<div class="col-xs-3 pl-1 pr-1">
				{% for num in pages.paginator.page_range %}
					{% if num == pages.number %}
						<a class="btn btn-info" href="?page={{num}}">{{num}}</a>
					{% elif num > pages.number|add:'-3' and num < pages.number|add:'3' %}
						<a class="btn btn-outline-info" href="?page={{num}}">{{num}}</a>
					{% endif %}
				{% endfor %}
			</div>
			<div class="col-xs-2 mr-auto">
				{% if pages.has_next %}
					<a class="btn btn-outline-info" href="?page={{pages.next_page_number}}">Next</a>
					<a class="btn btn-outline-info" href="?page={{pages.paginator.num_pages}}">Last</a>
				{% endif %}
			</div>
		</div>
	</div>
</div>
{% endblock %}
